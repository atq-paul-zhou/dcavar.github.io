<html>
<head>
<title>Charty2.scm</title>
<style type="text/css"><!--
.syntax0 {
color: #000000;
}
.syntax1 {
color: #cc0000;
}
.syntax2 {
color: #ff8400;
}
.syntax3 {
color: #6600cc;
}
.syntax4 {
color: #cc6600;
}
.syntax5 {
color: #ff0000;
}
.syntax6 {
color: #9966ff;
}
.syntax7 {
background: #ffffcc;
color: #ff0066;
}
.syntax8 {
color: #006699;
font-weight: bold;
}
.syntax9 {
color: #009966;
font-weight: bold;
}
.syntax10 {
color: #0099ff;
font-weight: bold;
}
.syntax11 {
color: #66ccff;
font-weight: bold;
}
.syntax12 {
color: #02b902;
}
.syntax13 {
color: #ff00cc;
}
.syntax14 {
color: #cc00cc;
}
.syntax15 {
color: #9900cc;
}
.syntax16 {
color: #6600cc;
}
.syntax17 {
color: #0000ff;
}
.syntax18 {
color: #000000;
font-weight: bold;
}
.gutter {
background: #dbdbdb;
color: #000000;
}
.gutterH {
background: #dbdbdb;
color: #990066;
}
--></style>
</head>
<body bgcolor="#ffffff">
<pre><span class="syntax0"><span class="gutter">   1:</span><span class="syntax13">&quot;</span><span class="syntax13">:</span><span class="syntax13">&quot;</span><span class="syntax1">;</span><span class="syntax1"> </span><span class="syntax1">exec</span><span class="syntax1"> </span><span class="syntax1">mzscheme</span><span class="syntax1"> </span><span class="syntax1">-r</span><span class="syntax1"> </span><span class="syntax1">$0</span><span class="syntax1"> </span><span class="syntax1">&quot;$@&quot;</span>
<span class="gutter">   2:</span>
<span class="gutter">   3:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">----------------------------------------------------</span>
<span class="gutter">   4:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">Filename:</span><span class="syntax1"> </span><span class="syntax1">Charty2.scm</span>
<span class="gutterH">   5:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">Author:</span><span class="syntax1"> </span><span class="syntax1"> </span><span class="syntax1"> </span><span class="syntax1">Damir</span><span class="syntax1"> </span><span class="syntax1">Cavar</span><span class="syntax1"> </span><span class="syntax1">&lt;dcavar@me.com&gt;</span>
<span class="gutter">   6:</span><span class="syntax1">;</span><span class="syntax1">;;</span>
<span class="gutter">   7:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">(C)</span><span class="syntax1"> </span><span class="syntax1">2006</span><span class="syntax1"> </span><span class="syntax1">by</span><span class="syntax1"> </span><span class="syntax1">Damir</span><span class="syntax1"> </span><span class="syntax1">Cavar</span>
<span class="gutter">   8:</span><span class="syntax1">;</span><span class="syntax1">;;</span>
<span class="gutter">   9:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">This</span><span class="syntax1"> </span><span class="syntax1">code</span><span class="syntax1"> </span><span class="syntax1">is</span><span class="syntax1"> </span><span class="syntax1">published</span><span class="syntax1"> </span><span class="syntax1">under</span><span class="syntax1"> </span><span class="syntax1">the</span><span class="syntax1"> </span><span class="syntax1">restrictive</span><span class="syntax1"> </span><span class="syntax1">GPL!</span>
<span class="gutterH">  10:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">Please</span><span class="syntax1"> </span><span class="syntax1">find</span><span class="syntax1"> </span><span class="syntax1">the</span><span class="syntax1"> </span><span class="syntax1">text</span><span class="syntax1"> </span><span class="syntax1">of</span><span class="syntax1"> </span><span class="syntax1">the</span><span class="syntax1"> </span><span class="syntax1">GPL</span><span class="syntax1"> </span><span class="syntax1">here:</span>
<span class="gutter">  11:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">http://www.gnu.org/licenses/gpl.txt</span>
<span class="gutter">  12:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span>
<span class="gutter">  13:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">It</span><span class="syntax1"> </span><span class="syntax1">is</span><span class="syntax1"> </span><span class="syntax1">free</span><span class="syntax1"> </span><span class="syntax1">for</span><span class="syntax1"> </span><span class="syntax1">use,</span><span class="syntax1"> </span><span class="syntax1">change,</span><span class="syntax1"> </span><span class="syntax1">etc.</span><span class="syntax1"> </span><span class="syntax1">as</span><span class="syntax1"> </span><span class="syntax1">long</span><span class="syntax1"> </span><span class="syntax1">as</span><span class="syntax1"> </span><span class="syntax1">the</span><span class="syntax1"> </span><span class="syntax1">copyright</span>
<span class="gutter">  14:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">note</span><span class="syntax1"> </span><span class="syntax1">above</span><span class="syntax1"> </span><span class="syntax1">is</span><span class="syntax1"> </span><span class="syntax1">included</span><span class="syntax1"> </span><span class="syntax1">in</span><span class="syntax1"> </span><span class="syntax1">any</span><span class="syntax1"> </span><span class="syntax1">modified</span><span class="syntax1"> </span><span class="syntax1">version</span><span class="syntax1"> </span><span class="syntax1">of</span><span class="syntax1"> </span><span class="syntax1">the</span><span class="syntax1"> </span><span class="syntax1">code.</span>
<span class="gutterH">  15:</span><span class="syntax1">;</span><span class="syntax1">;;</span>
<span class="gutter">  16:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">Usage:</span>
<span class="gutter">  17:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">mzscheme</span><span class="syntax1"> </span><span class="syntax1">-r</span><span class="syntax1"> </span><span class="syntax1">Charty2.scm</span><span class="syntax1"> </span><span class="syntax1">John</span><span class="syntax1"> </span><span class="syntax1">kissed</span><span class="syntax1"> </span><span class="syntax1">Mary</span>
<span class="gutter">  18:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">----------------------------------------------------</span>
<span class="gutter">  19:</span>
<span class="gutterH">  20:</span>(<span class="syntax9">load</span> <span class="syntax13">&quot;</span><span class="syntax13">list-extra.ss</span><span class="syntax13">&quot;</span>)
<span class="gutter">  21:</span>(<span class="syntax9">load</span> <span class="syntax13">&quot;</span><span class="syntax13">grammar2.scm</span><span class="syntax13">&quot;</span>)
<span class="gutter">  22:</span>
<span class="gutter">  23:</span>
<span class="gutter">  24:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">global</span><span class="syntax1"> </span><span class="syntax1">variable</span><span class="syntax1"> </span><span class="syntax1">for</span><span class="syntax1"> </span><span class="syntax1">the</span><span class="syntax1"> </span><span class="syntax1">chart</span>
<span class="gutterH">  25:</span>(<span class="syntax8">define</span> chart '())
<span class="gutter">  26:</span>
<span class="gutter">  27:</span>
<span class="gutter">  28:</span>(<span class="syntax8">define</span> inactive-edge
<span class="gutter">  29:</span>  (<span class="syntax8">lambda</span> (edge)
<span class="gutterH">  30:</span>    (<span class="syntax8">if</span> (&gt;= (<span class="syntax9">caddr</span> edge) (<span class="syntax9">length</span> (<span class="syntax9">list-ref</span> edge <span class="syntax5">4</span>)))
<span class="gutter">  31:</span>        <span class="syntax14">#t</span>
<span class="gutter">  32:</span>        <span class="syntax14">#f</span>)))
<span class="gutter">  33:</span>
<span class="gutter">  34:</span>
<span class="gutterH">  35:</span>(<span class="syntax8">define</span> active-edge
<span class="gutter">  36:</span>  (<span class="syntax8">lambda</span> (edge)
<span class="gutter">  37:</span>    (<span class="syntax9">not</span> (inactive-edge edge))))
<span class="gutter">  38:</span>
<span class="gutter">  39:</span>
<span class="gutterH">  40:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">rule-invocation</span>
<span class="gutter">  41:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">find</span><span class="syntax1"> </span><span class="syntax1">complete</span><span class="syntax1"> </span><span class="syntax1">edges</span><span class="syntax1"> </span><span class="syntax1">and</span><span class="syntax1"> </span><span class="syntax1">add</span><span class="syntax1"> </span><span class="syntax1">rules</span><span class="syntax1"> </span><span class="syntax1">that</span><span class="syntax1"> </span><span class="syntax1">have</span><span class="syntax1"> </span><span class="syntax1">the</span><span class="syntax1"> </span><span class="syntax1">LHS</span><span class="syntax1"> </span><span class="syntax1">symbol</span>
<span class="gutter">  42:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">as</span><span class="syntax1"> </span><span class="syntax1">the</span><span class="syntax1"> </span><span class="syntax1">first</span><span class="syntax1"> </span><span class="syntax1">RHS</span><span class="syntax1"> </span><span class="syntax1">symbol</span>
<span class="gutter">  43:</span>(<span class="syntax8">define</span> rule-invocation!
<span class="gutter">  44:</span>  (<span class="syntax8">lambda</span> (start)
<span class="gutterH">  45:</span>    (printf <span class="syntax13">&quot;</span><span class="syntax13">Rule</span><span class="syntax13"> </span><span class="syntax13">invocation:\n</span><span class="syntax13">&quot;</span>)
<span class="gutter">  46:</span>    (<span class="syntax9">for-each</span> <span class="syntax1">;</span><span class="syntax1"> </span><span class="syntax1">edge</span><span class="syntax1"> </span><span class="syntax1">on</span><span class="syntax1"> </span><span class="syntax1">chart</span><span class="syntax1"> </span><span class="syntax1">starting</span><span class="syntax1"> </span><span class="syntax1">from</span><span class="syntax1"> </span><span class="syntax1">start</span>
<span class="gutter">  47:</span>     (<span class="syntax8">lambda</span> (edge)
<span class="gutter">  48:</span>       (<span class="syntax8">if</span> (inactive-edge edge) <span class="syntax1">;</span><span class="syntax1"> </span><span class="syntax1">if</span><span class="syntax1"> </span><span class="syntax1">edge</span><span class="syntax1"> </span><span class="syntax1">not</span><span class="syntax1"> </span><span class="syntax1">active</span>
<span class="gutter">  49:</span>           (<span class="syntax8">let</span> ([rhss (hash-table-get rhsl (<span class="syntax9">list-ref</span> edge <span class="syntax5">3</span>) '())])
<span class="gutterH">  50:</span>             (<span class="syntax9">for-each</span> <span class="syntax1">;</span><span class="syntax1"> </span><span class="syntax1">for</span><span class="syntax1"> </span><span class="syntax1">each</span><span class="syntax1"> </span><span class="syntax1">RHS</span><span class="syntax1"> </span><span class="syntax1">with</span><span class="syntax1"> </span><span class="syntax1">LHS</span><span class="syntax1"> </span><span class="syntax1">as</span><span class="syntax1"> </span><span class="syntax1">initial</span><span class="syntax1"> </span><span class="syntax1">symbol</span>
<span class="gutter">  51:</span>              (<span class="syntax8">lambda</span> (x)
<span class="gutter">  52:</span>                (<span class="syntax9">for-each</span> <span class="syntax1">;</span><span class="syntax1"> </span><span class="syntax1">for</span><span class="syntax1"> </span><span class="syntax1">each</span><span class="syntax1"> </span><span class="syntax1">LHS</span><span class="syntax1"> </span><span class="syntax1">with</span><span class="syntax1"> </span><span class="syntax1">this</span><span class="syntax1"> </span><span class="syntax1">RHS</span>
<span class="gutter">  53:</span>                 (<span class="syntax8">lambda</span> (y) <span class="syntax1">;</span><span class="syntax1"> </span><span class="syntax1">create</span><span class="syntax1"> </span><span class="syntax1">new</span><span class="syntax1"> </span><span class="syntax1">edge</span>
<span class="gutter">  54:</span>                   (<span class="syntax8">let</span> ([newedge (<span class="syntax9">list</span> (<span class="syntax9">car</span> edge) (<span class="syntax9">cadr</span> edge) <span class="syntax5">1</span> y x (<span class="syntax9">append</span> (<span class="syntax9">list</span> (list-index
<span class="gutterH">  55:</span>                                                                                    (<span class="syntax8">lambda</span> (el)
<span class="gutter">  56:</span>                                                                                      (<span class="syntax10">eq?</span> el edge))
<span class="gutter">  57:</span>                                                                                    chart))))])
<span class="gutter">  58:</span>                     (printf <span class="syntax13">&quot;</span><span class="syntax13">Based</span><span class="syntax13"> </span><span class="syntax13">on</span><span class="syntax13"> </span><span class="syntax13">edge:</span><span class="syntax13"> </span><span class="syntax13">~a\n</span><span class="syntax13">&quot;</span> edge)
<span class="gutter">  59:</span>                     (printf <span class="syntax13">&quot;</span><span class="syntax13">Adding</span><span class="syntax13"> </span><span class="syntax13">edge:</span><span class="syntax13"> </span><span class="syntax13"> </span><span class="syntax13"> </span><span class="syntax13">~a\n</span><span class="syntax13">&quot;</span> newedge)
<span class="gutterH">  60:</span>                     (unless (<span class="syntax9">member</span> chart newedge) <span class="syntax1">;</span><span class="syntax1"> </span><span class="syntax1">if</span><span class="syntax1"> </span><span class="syntax1">not</span><span class="syntax1"> </span><span class="syntax1">on</span><span class="syntax1"> </span><span class="syntax1">chart,</span><span class="syntax1"> </span><span class="syntax1">append</span><span class="syntax1"> </span><span class="syntax1">to</span><span class="syntax1"> </span><span class="syntax1">chart</span>
<span class="gutter">  61:</span>                       (<span class="syntax8">set!</span> chart (<span class="syntax9">append</span> chart (<span class="syntax9">list</span> newedge))))))
<span class="gutter">  62:</span>                 (hash-table-get rhs x '())))
<span class="gutter">  63:</span>              rhss))))
<span class="gutter">  64:</span>     (drop chart start))))
<span class="gutterH">  65:</span>
<span class="gutter">  66:</span>
<span class="gutter">  67:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">fundamental-rule</span>
<span class="gutter">  68:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">find</span><span class="syntax1"> </span><span class="syntax1">active</span><span class="syntax1"> </span><span class="syntax1">edges</span><span class="syntax1"> </span><span class="syntax1">and</span><span class="syntax1"> </span><span class="syntax1">axpand</span><span class="syntax1"> </span><span class="syntax1">them</span><span class="syntax1"> </span><span class="syntax1">with</span><span class="syntax1"> </span><span class="syntax1">inactive,</span><span class="syntax1"> </span><span class="syntax1">i.e.</span>
<span class="gutter">  69:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">the</span><span class="syntax1"> </span><span class="syntax1">first</span><span class="syntax1"> </span><span class="syntax1">symbol</span><span class="syntax1"> </span><span class="syntax1">after</span><span class="syntax1"> </span><span class="syntax1">the</span><span class="syntax1"> </span><span class="syntax1">dot</span><span class="syntax1"> </span><span class="syntax1">as</span><span class="syntax1"> </span><span class="syntax1">their</span><span class="syntax1"> </span><span class="syntax1">LHS</span><span class="syntax1"> </span><span class="syntax1">symbol</span>
<span class="gutterH">  70:</span>(<span class="syntax8">define</span> fundamental-rule!
<span class="gutter">  71:</span>  (<span class="syntax8">lambda</span> ()
<span class="gutter">  72:</span>    (printf <span class="syntax13">&quot;</span><span class="syntax13">Fundamental</span><span class="syntax13"> </span><span class="syntax13">rule:\n</span><span class="syntax13">&quot;</span>)
<span class="gutter">  73:</span>    (<span class="syntax9">for-each</span> <span class="syntax1">;</span><span class="syntax1"> </span><span class="syntax1">edge</span><span class="syntax1"> </span><span class="syntax1">on</span><span class="syntax1"> </span><span class="syntax1">chart</span>
<span class="gutter">  74:</span>     (<span class="syntax8">lambda</span> (edge)
<span class="gutterH">  75:</span>       (<span class="syntax8">if</span> (active-edge edge)
<span class="gutter">  76:</span>           (<span class="syntax8">let</span> ([expectation (<span class="syntax9">list-ref</span> (<span class="syntax9">list-ref</span> edge <span class="syntax5">4</span>) (<span class="syntax9">caddr</span> edge))])
<span class="gutter">  77:</span>             (<span class="syntax9">for-each</span> <span class="syntax1">;</span><span class="syntax1"> </span><span class="syntax1">edge</span><span class="syntax1"> </span><span class="syntax1">on</span><span class="syntax1"> </span><span class="syntax1">chart</span>
<span class="gutter">  78:</span>              (<span class="syntax8">lambda</span> (oe)
<span class="gutter">  79:</span>                (<span class="syntax8">if</span> (inactive-edge oe)
<span class="gutterH">  80:</span>                    (<span class="syntax8">if</span> (<span class="syntax8">and</span> (<span class="syntax10">eq?</span> expectation (<span class="syntax9">list-ref</span> oe <span class="syntax5">3</span>))
<span class="gutter">  81:</span>                             (= (<span class="syntax9">cadr</span> edge) (<span class="syntax9">car</span> oe)))
<span class="gutter">  82:</span>                        (<span class="syntax8">begin</span>
<span class="gutter">  83:</span>                          (<span class="syntax8">let</span> ([newedge (<span class="syntax9">list</span> (<span class="syntax9">car</span> edge)
<span class="gutter">  84:</span>                                               (<span class="syntax9">cadr</span> oe)
<span class="gutterH">  85:</span>                                               (+ (<span class="syntax9">caddr</span> edge) <span class="syntax5">1</span>)
<span class="gutter">  86:</span>                                               (<span class="syntax9">list-ref</span> edge <span class="syntax5">3</span>)
<span class="gutter">  87:</span>                                               (<span class="syntax9">list-ref</span> edge <span class="syntax5">4</span>)
<span class="gutter">  88:</span>                                               (<span class="syntax9">append</span> (<span class="syntax9">list-ref</span> edge <span class="syntax5">5</span>)
<span class="gutter">  89:</span>                                                       (<span class="syntax9">list</span> (list-index
<span class="gutterH">  90:</span>                                                              (<span class="syntax8">lambda</span> (el)
<span class="gutter">  91:</span>                                                                (<span class="syntax10">eq?</span> el oe))
<span class="gutter">  92:</span>                                                              chart))))])
<span class="gutter">  93:</span>                            (unless (<span class="syntax9">member</span> newedge chart)
<span class="gutter">  94:</span>                              (printf <span class="syntax13">&quot;</span><span class="syntax13">These</span><span class="syntax13"> </span><span class="syntax13">edges</span><span class="syntax13"> </span><span class="syntax13">fit:\n~a\n~a\n</span><span class="syntax13">&quot;</span> edge oe)
<span class="gutterH">  95:</span>                              (printf <span class="syntax13">&quot;</span><span class="syntax13">Adding</span><span class="syntax13"> </span><span class="syntax13">edge:</span><span class="syntax13"> </span><span class="syntax13">~a\n</span><span class="syntax13">&quot;</span> newedge)
<span class="gutter">  96:</span>                              (<span class="syntax8">set!</span> chart (<span class="syntax9">append</span> chart (<span class="syntax9">list</span> newedge)))))))))
<span class="gutter">  97:</span>              chart))))
<span class="gutter">  98:</span>     chart)))
<span class="gutter">  99:</span>
<span class="gutterH"> 100:</span>
<span class="gutter"> 101:</span>(<span class="syntax8">define</span> parse
<span class="gutter"> 102:</span>  (<span class="syntax8">lambda</span> (tokens)
<span class="gutter"> 103:</span>    (printf <span class="syntax13">&quot;</span><span class="syntax13">Initialize</span><span class="syntax13"> </span><span class="syntax13">the</span><span class="syntax13"> </span><span class="syntax13">chart</span><span class="syntax13"> </span><span class="syntax13">from</span><span class="syntax13"> </span><span class="syntax13">tokens:</span><span class="syntax13"> </span><span class="syntax13">~a\n</span><span class="syntax13">&quot;</span> tokens)
<span class="gutter"> 104:</span>    (<span class="syntax8">let</span> window ([w (<span class="syntax9">length</span> tokens)])
<span class="gutterH"> 105:</span>      (<span class="syntax8">let</span> iloop ([i <span class="syntax5">0</span>])
<span class="gutter"> 106:</span>        (<span class="syntax8">let</span> ([x (sublist tokens i (+ i w))])
<span class="gutter"> 107:</span>          (<span class="syntax8">let</span> ([vals  (hash-table-get rhs x '())]
<span class="gutter"> 108:</span>                [parse '()])
<span class="gutter"> 109:</span>            (<span class="syntax9">for-each</span> (<span class="syntax8">lambda</span> (y)
<span class="gutterH"> 110:</span>                        <span class="syntax1">;</span><span class="syntax1"> </span><span class="syntax1">create</span><span class="syntax1"> </span><span class="syntax1">edge</span><span class="syntax1"> </span><span class="syntax1">with</span><span class="syntax1"> </span><span class="syntax1">span</span>
<span class="gutter"> 111:</span>                        (<span class="syntax8">let</span> ([edge (<span class="syntax9">list</span> i (+ i w) w y x '())])
<span class="gutter"> 112:</span>                          (unless (<span class="syntax9">member</span> edge chart)
<span class="gutter"> 113:</span>                            (<span class="syntax8">set!</span> chart (<span class="syntax9">append</span> chart (<span class="syntax9">list</span> edge))))))
<span class="gutter"> 114:</span>                      vals)))
<span class="gutterH"> 115:</span>        (unless (&gt;= (+ i w) (<span class="syntax9">length</span> tokens))
<span class="gutter"> 116:</span>          (iloop (+ i <span class="syntax5">1</span>))))
<span class="gutter"> 117:</span>      (unless (&lt;= w <span class="syntax5">1</span>)
<span class="gutter"> 118:</span>        (window (- w <span class="syntax5">1</span>))))
<span class="gutter"> 119:</span>    <span class="syntax1">;</span><span class="syntax1"> </span><span class="syntax1">apply</span><span class="syntax1"> </span><span class="syntax1">rule</span><span class="syntax1"> </span><span class="syntax1">invocation,</span><span class="syntax1"> </span><span class="syntax1">fundamental</span><span class="syntax1"> </span><span class="syntax1">rule,</span><span class="syntax1"> </span><span class="syntax1">until</span><span class="syntax1"> </span><span class="syntax1">nothing</span><span class="syntax1"> </span><span class="syntax1">more</span><span class="syntax1"> </span><span class="syntax1">possible</span>
<span class="gutterH"> 120:</span>    (<span class="syntax8">let</span> ([start  <span class="syntax5">0</span>]
<span class="gutter"> 121:</span>          [oldlen (<span class="syntax9">length</span> chart)])
<span class="gutter"> 122:</span>      (<span class="syntax8">let</span> loop ()
<span class="gutter"> 123:</span>        (rule-invocation! start)
<span class="gutter"> 124:</span>        (fundamental-rule!)
<span class="gutterH"> 125:</span>        <span class="syntax1">;</span><span class="syntax1"> </span><span class="syntax1">something</span><span class="syntax1"> </span><span class="syntax1">changed</span><span class="syntax1"> </span><span class="syntax1">on</span><span class="syntax1"> </span><span class="syntax1">the</span><span class="syntax1"> </span><span class="syntax1">chart</span>
<span class="gutter"> 126:</span>        (<span class="syntax8">if</span> (&gt; (<span class="syntax9">length</span> chart) oldlen)
<span class="gutter"> 127:</span>            (<span class="syntax8">begin</span>
<span class="gutter"> 128:</span>              (<span class="syntax8">set!</span> start  oldlen)
<span class="gutter"> 129:</span>              (<span class="syntax8">set!</span> oldlen (<span class="syntax9">length</span> chart))
<span class="gutterH"> 130:</span>              (loop)))))))
<span class="gutter"> 131:</span>
<span class="gutter"> 132:</span>
<span class="gutter"> 133:</span>
<span class="gutter"> 134:</span><span class="syntax1">;</span><span class="syntax1">;;</span><span class="syntax1"> </span><span class="syntax1">-----------------------------</span>
<span class="gutterH"> 135:</span>(load-grammar <span class="syntax13">&quot;</span><span class="syntax13">grammar.txt</span><span class="syntax13">&quot;</span>)
<span class="gutter"> 136:</span>(<span class="syntax8">if</span> (&lt; <span class="syntax5">0</span> (<span class="syntax9">vector-length</span> argv))
<span class="gutter"> 137:</span>    (<span class="syntax8">begin</span>
<span class="gutter"> 138:</span>      (parse (map-in-order (<span class="syntax8">lambda</span> (x)
<span class="gutter"> 139:</span>                             (<span class="syntax9">string-&gt;symbol</span> x))
<span class="gutterH"> 140:</span>                           (<span class="syntax9">vector-&gt;list</span> argv)))
<span class="gutter"> 141:</span>      (printf <span class="syntax13">&quot;</span><span class="syntax13">Final</span><span class="syntax13"> </span><span class="syntax13">chart:\n</span><span class="syntax13">&quot;</span>)
<span class="gutter"> 142:</span>      (<span class="syntax8">let</span> ([counter -1])
<span class="gutter"> 143:</span>        (<span class="syntax9">for-each</span> (<span class="syntax8">lambda</span> (z)
<span class="gutter"> 144:</span>                    (<span class="syntax8">set!</span> counter (+ counter <span class="syntax5">1</span>))
<span class="gutterH"> 145:</span>                    (<span class="syntax8">if</span> (inactive-edge z)
<span class="gutter"> 146:</span>                        (printf <span class="syntax13">&quot;</span><span class="syntax13">~a:</span><span class="syntax13"> </span><span class="syntax13">~a\n</span><span class="syntax13">&quot;</span> counter z)))
<span class="gutter"> 147:</span>                  chart))))
<span class="gutter"> 148:</span>
<span class="gutter"> 149:</span>
<span class="gutterH"> 150:</span>
</span></pre>

<br/>
<br/>
<br/>
<center>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-8896209246743797";
/* HomePage-DC-small */
google_ad_slot = "9466016636";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</center>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-21704386-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></body>
</html>

